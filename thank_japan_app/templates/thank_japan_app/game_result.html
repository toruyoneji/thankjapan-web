{% extends 'base.html' %}

{% block title %}Game Result | ThankJapan - Challenge your knowledge!{% endblock %}

{% block meta %}
<meta name="description" content="Check your game result and see the top 20 players on ThankJapan! Test your knowledge about Japan.">
<meta property="og:title" content="Game Result | ThankJapan">
<meta property="og:description" content="Did you rank among the top 20? Check your score now!">
<meta property="og:image" content="https://res.cloudinary.com/dotekofm5/image/upload/v1754642770/thankjapan/backgrounds/ntpvmxgudcmvp0snpiur.png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.thankjapan.com/game/result/">
<meta name="twitter:card" content="summary_large_image">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "ThankJapan Top 20 Players Ranking",
  "itemListElement": [
    {% for r in ranking %}
    {
      "@type": "ListItem",
      "position": {{ forloop.counter }},
      "name": "{{ r.username|escapejs }}",
      "url": "https://www.thankjapan.com/",
      "description": "Score: {{ r.total_score }}, Country: {{ r.country|default:'Unknown'|escapejs }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ]
}
</script>
{% endblock %}

{% block content %}


<!-- ËÉåÊôØ„Ç≠„É£„É≥„Éê„Çπ -->
<canvas id="spaceCanvas" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:1;"></canvas>

<div class="main2">
  <h1>üéâ Game Result üéâ</h1>

  <div class="score-box">
    <p style="font-size:1.5rem;">Player: {{ player.username }} ({{ player.country|default:"Unknown" }})</p>
    <p>Your Score: <span class="score-number" id="score">0</span> pts</p>
  </div>

  <hr style="margin: 30px 0; border-color: #fff4;">

  <h2 style="color: #ff6ec7;">üèÜ Top 10 Players</h2>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Username</th>
        <th>Points</th>
        <th>Country</th>
      </tr>
    </thead>
    <tbody>
      {% for r in ranking %}
      <tr class="{% if forloop.first %}highlight{% endif %}">
        <td>{{ forloop.counter }}</td>
        <td>{{ r.username }}</td>
        <td>{{ r.total_score }}</td>
        <td>{{ r.country|default:"-" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4">No rankings yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <div>
    <a href="{% url 'game_restart' %}">
      <button class="neon-button">üîÅ Play Again</button>
    </a>
    <a href="{% url 'logout_player' %}">
      <button class="neon-button">üö™ Logout</button>
    </a>
  </div>

  <form method="post" action="{% url 'delete_player_confirm' %}" onsubmit="return confirm('Are you sure you want to delete your account?');">
    {% csrf_token %}
    <button type="submit" class="neon-button" style="background:#dc2626; border-color:#dc2626;">üóëÔ∏è Delete My Account</button>
  </form>
</div>

<!-- CSS -->
<style>
body {
  font-family: 'Orbitron', sans-serif;
  margin:0; padding:0;
  background: linear-gradient(135deg, #2b003e, #5d1a8b, #8b4fff);
  overflow-x:hidden;
}

.main2 {
  position: fixed;
  top: 140px; /* „Éò„ÉÉ„ÉÄ„Éº‰∏ã */
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  width: 90%;
  max-width: 900px;
  text-align: center;
  color: #fff;
}

h1 {
  font-size: 3rem;
  color: #ff6ec7;
  text-shadow: 0 0 5px #ff6ec7,0 0 10px #ff4da6,0 0 20px #ff6ec7,0 0 40px #ff4da6;
  animation: neon-flicker 1.5s infinite alternate;
}

@keyframes neon-flicker {
  0%,19%,21%,23%,25%,54%,56%,100% { text-shadow:0 0 5px #ff6ec7,0 0 10px #ff4da6,0 0 20px #ff6ec7,0 0 40px #ff4da6;}
  20%,24%,55% { text-shadow:none; }
}

.score-box {
  background: rgba(0,0,0,0.5);
  padding: 30px;
  margin: 20px auto;
  border-radius: 15px;
  box-shadow: 0 0 15px #ff6ec7, 0 0 30px #ff4da6 inset;
}

.score-number {
  font-size: 3rem;
  color: #ff4da6;
  text-shadow: 0 0 10px #ff4da6, 0 0 20px #ff6ec7 inset;
  display:inline-block;
  animation: bounce 0.6s ease infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.neon-button {
  background: #1b0033;
  color: #ff6ec7;
  padding: 15px 40px;
  font-size: 1.3rem;
  font-weight: 700;
  border: 2px solid #ff6ec7;
  border-radius: 25px;
  box-shadow: 0 0 8px #ff6ec7, 0 0 15px #ff4da6 inset;
  cursor: pointer;
  transition: 0.3s;
  margin: 10px;
}

.neon-button:hover {
  box-shadow: 0 0 20px #ff6ec7, 0 0 30px #ff4da6 inset;
  color: #fff;
}

table {
  width: 90%;
  max-width: 700px;
  margin: 20px auto;
  border-collapse: collapse;
  color: #fff;
}

thead th {
  background: linear-gradient(90deg, #ff6ec7, #3b82f6, #ffcd3c);
  padding: 10px;
  font-size: 1.2rem;
  text-shadow: 0 0 5px #fff;
}

tbody tr {
  background: rgba(255,255,255,0.05);
  transition: 0.3s;
}

tbody tr:hover {
  background: rgba(255,255,255,0.2);
}

.highlight {
  background: #ff4da6;
  color: #000;
  font-weight: bold;
  text-shadow: 0 0 5px #fff;
}

@media (max-width: 500px) {
  .main2 {
    top: 260px;
    width: 95%;
  }
}
</style>

{{ score|default:0|json_script:"score-data" }}
<script>
  // „Çπ„Ç≥„Ç¢„Ç´„Ç¶„É≥„Éà„Ç¢„ÉÉ„Éó
  const finalScore = JSON.parse(document.getElementById('score-data').textContent);
  const scoreElement = document.getElementById('score');
  let current = 0;
  const interval = setInterval(() => {
    if (current < finalScore) {
      current++;
      scoreElement.textContent = current;
    } else {
      clearInterval(interval);
    }
  }, 50);

  // ÂÆáÂÆôËÉåÊôØ„Å®Êòü„ÉªÂÖâ„ÉªËä±ÁÅ´
  const canvas = document.getElementById('spaceCanvas');
  const ctx = canvas.getContext('2d');
  let stars = [];
  let fireworks = [];

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // Êòü„Çí‰Ωú„Çã
  for(let i=0;i<150;i++){
    stars.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height,
      radius: Math.random()*1.5,
      alpha: Math.random()
    });
  }

  // Ëä±ÁÅ´ÁîüÊàê
  function createFirework() {
    fireworks.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height/2,
      radius: Math.random()*3+2,
      color:`hsl(${Math.random()*360},100%,70%)`,
      alpha:1
    });
  }

  function animate() {
    ctx.fillStyle = 'rgba(45,0,75,0.3)';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // ÊòüÊèèÁîª
    stars.forEach(s=>{
      ctx.beginPath();
      ctx.arc(s.x,s.y,s.radius,0,Math.PI*2);
      ctx.fillStyle = `rgba(255,255,255,${s.alpha})`;
      ctx.fill();
      s.alpha += (Math.random()-0.5)*0.05;
      if(s.alpha<0)s.alpha=0;
      if(s.alpha>1)s.alpha=1;
    });

    // Ëä±ÁÅ´ÊèèÁîª
    fireworks.forEach((f,i)=>{
      ctx.beginPath();
      ctx.arc(f.x,f.y,f.radius,0,Math.PI*2);
      ctx.fillStyle = `rgba(${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${Math.floor(Math.random()*255)},${f.alpha})`;
      ctx.fill();
      f.alpha -= 0.02;
      if(f.alpha<=0) fireworks.splice(i,1);
    });

    // „É©„É≥„ÉÄ„É†„Å´Ëä±ÁÅ´ËøΩÂä†
    if(Math.random()<0.02) createFirework();

    requestAnimationFrame(animate);
  }
  animate();

  // ÂÖâ„Ç§„É≥„Çø„É©„ÇØ„Ç∑„Éß„É≥
  canvas.addEventListener('mousemove', e=>{
    const gradient = ctx.createRadialGradient(e.clientX,e.clientY,0, e.clientX,e.clientY,100);
    gradient.addColorStop(0,'rgba(255,255,255,0.6)');
    gradient.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle = gradient;
    ctx.fillRect(0,0,canvas.width,canvas.height);
  });
</script>

{% endblock %}
